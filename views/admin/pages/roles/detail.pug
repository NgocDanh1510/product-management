extends ../../layout/default.pug

block main
  //- Page Header
  .d-flex.justify-content-between.align-items-center.mb-4
    div
      h2.fw-bold.mb-1
        i.bi.bi-eye.me-2.text-info
        | Chi Tiết Vai Trò
      p.text-muted.mb-0 Xem thông tin và quyền hạn
    .d-flex.gap-2
      a.btn.btn-warning(href=`${prefixAdmin}/roles/edit/${role.id}`)
        i.bi.bi-pencil.me-2
        | Chỉnh Sửa
      a.btn.btn-outline-secondary(href=`${prefixAdmin}/roles`)
        i.bi.bi-arrow-left.me-2
        | Quay Lại

  .row
    //- Left Column - Info
    .col-lg-8
      //- Basic Info Card
      .card.mb-3.border-0.shadow-sm
        .card-header.bg-white
          h6.mb-0.fw-semibold
            i.bi.bi-info-circle.me-2
            | Thông Tin Cơ Bản
        .card-body
          .row.mb-3
            .col-md-3
              strong.text-muted
                i.bi.bi-tag.me-2
                | Tên vai trò:
            .col-md-9
              span.fs-5 #{role.title}
          
          .row.mb-3
            .col-md-3
              strong.text-muted
                i.bi.bi-file-text.me-2
                | Mô tả:
            .col-md-9
              if role.description
                p.mb-0= role.description
              else
                span.text-muted.fst-italic Chưa có mô tả

          .row
            .col-md-3
              strong.text-muted
                i.bi.bi-toggle-on.me-2
                | Trạng thái:
            .col-md-9
              if role.status === 'active'
                span.badge.bg-success.px-3.py-2
                  i.bi.bi-check-circle-fill.me-1
                  | Hoạt động
              else
                span.badge.bg-danger.px-3.py-2
                  i.bi.bi-x-circle-fill.me-1
                  | Dừng hoạt động

      //- Permissions Card
      .card.mb-3.border-0.shadow-sm
        .card-header.bg-white
          h6.mb-0.fw-semibold
            i.bi.bi-key.me-2
            | Quyền Hạn
        .card-body
          if role.permissions && role.permissions.length > 0
            //- Products Permissions
            - const productPerms = role.permissions.filter(p => p.startsWith('products_'))
            if productPerms.length > 0
              .mb-4
                h6.fw-semibold.mb-3
                  i.bi.bi-box-seam.me-2.text-primary
                  | Quản lý Sản phẩm
                .row
                  -
                    const productPermission = [
                      { id: 'view', label: 'Xem sản phẩm', icon: 'eye', color: 'info' },
                      { id: 'create', label: 'Thêm sản phẩm', icon: 'plus-circle', color: 'success' },
                      { id: 'edit', label: 'Sửa sản phẩm', icon: 'pencil', color: 'warning' },
                      { id: 'delete', label: 'Xóa sản phẩm', icon: 'trash', color: 'danger' }
                    ]
                  each item in productPermission
                    if role.permissions.includes(`products_${item.id}`)
                      .col-md-6.mb-2
                        .border.rounded.p-3.bg-light
                          i(class=`bi bi-${item.icon} text-${item.color} me-2`)
                          i.bi.bi-check-circle-fill.text-success.me-2
                          span #{item.label}

            //- Products Category Permissions
            - const categoryPerms = role.permissions.filter(p => p.startsWith('products-category_'))
            if categoryPerms.length > 0
              .mb-4
                h6.fw-semibold.mb-3
                  i.bi.bi-list-ul.me-2.text-primary
                  | Quản lý Danh mục
                .row
                  -
                    const categoryPermission = [
                      { id: 'view', label: 'Xem danh mục', icon: 'eye', color: 'info' },
                      { id: 'create', label: 'Thêm danh mục', icon: 'plus-circle', color: 'success' },
                      { id: 'edit', label: 'Sửa danh mục', icon: 'pencil', color: 'warning' },
                      { id: 'delete', label: 'Xóa danh mục', icon: 'trash', color: 'danger' }
                    ]
                  each item in categoryPermission
                    if role.permissions.includes(`products-category_${item.id}`)
                      .col-md-6.mb-2
                        .border.rounded.p-3.bg-light
                          i(class=`bi bi-${item.icon} text-${item.color} me-2`)
                          i.bi.bi-check-circle-fill.text-success.me-2
                          span #{item.label}

            //- Roles Permissions
            - const rolesPerms = role.permissions.filter(p => p.startsWith('roles_'))
            if rolesPerms.length > 0
              .mb-4
                h6.fw-semibold.mb-3
                  i.bi.bi-shield-lock.me-2.text-primary
                  | Quản lý Vai trò
                .row
                  -
                    const rolesPermission = [
                      { id: 'view', label: 'Xem vai trò' },
                      { id: 'create', label: 'Thêm vai trò' },
                      { id: 'edit', label: 'Sửa vai trò' },
                      { id: 'delete', label: 'Xóa vai trò' },
                      { id: 'permissions', label: 'Phân quyền' }
                    ]
                  each item in rolesPermission
                    if role.permissions.includes(`roles_${item.id}`)
                      .col-md-6.mb-2
                        .border.rounded.p-3.bg-light
                          i.bi.bi-shield-check.text-primary.me-2
                          i.bi.bi-check-circle-fill.text-success.me-2
                          span #{item.label}

            //- Accounts Permissions
            - const accountsPerms = role.permissions.filter(p => p.startsWith('accounts_'))
            if accountsPerms.length > 0
              .mb-4
                h6.fw-semibold.mb-3
                  i.bi.bi-person-badge.me-2.text-primary
                  | Quản lý Tài khoản
                .row
                  -
                    const AccountsPermissions = [
                      { id: 'view', label: 'Xem tài khoản' },
                      { id: 'create', label: 'Thêm tài khoản' },
                      { id: 'edit', label: 'Sửa tài khoản' },
                      { id: 'delete', label: 'Xóa tài khoản' }
                    ]
                  each item in AccountsPermissions
                    if role.permissions.includes(`accounts_${item.id}`)
                      .col-md-6.mb-2
                        .border.rounded.p-3.bg-light
                          i.bi.bi-person-check.text-primary.me-2
                          i.bi.bi-check-circle-fill.text-success.me-2
                          span #{item.label}
          else
            .alert.alert-warning.mb-0
              i.bi.bi-exclamation-triangle.me-2
              | Vai trò này chưa có quyền nào được phân

    //- Right Column - Metadata
    .col-lg-4
      //- Statistics Card
      .card.mb-3.border-0.shadow-sm
        .card-header.bg-white
          h6.mb-0.fw-semibold
            i.bi.bi-graph-up.me-2
            | Thống Kê
        .card-body
          .d-flex.justify-content-between.align-items-center.mb-3.pb-3.border-bottom
            div
              .text-muted.small Tổng Quyền
              .fs-4.fw-bold.text-primary #{role.permissions ? role.permissions.length : 0}
            i.bi.bi-key-fill.fs-1.text-primary.opacity-25

          .d-flex.justify-content-between.align-items-center
            div
              .text-muted.small Trạng Thái
              if role.status === 'active'
                .badge.bg-success.mt-1 Hoạt động
              else
                .badge.bg-danger.mt-1 Dừng

      //- Timeline Card
      .card.mb-3.border-0.shadow-sm
        .card-header.bg-white
          h6.mb-0.fw-semibold
            i.bi.bi-clock-history.me-2
            | Lịch Sử
        .card-body
          .small
            .d-flex.mb-3
              .me-3
                i.bi.bi-calendar-plus.fs-5.text-success
              div
                .text-muted Ngày tạo
                .fw-semibold #{role.createdAt}
            
            .d-flex
              .me-3
                i.bi.bi-calendar-check.fs-5.text-info
              div
                .text-muted Cập nhật lần cuối
                .fw-semibold #{role.updatedAt}

      //- Actions Card
      .card.mb-3.border-0.shadow-sm
        .card-header.bg-white
          h6.mb-0.fw-semibold
            i.bi.bi-lightning.me-2
            | Thao Tác
        .card-body
          .d-grid.gap-2
            a.btn.btn-warning(href=`${prefixAdmin}/roles/edit/${role.id}`)
              i.bi.bi-pencil.me-2
              | Chỉnh Sửa
            
            button.btn.btn-outline-danger(
              type="button"
              data-bs-toggle="modal"
              data-bs-target="#deleteModal"
            )
              i.bi.bi-trash.me-2
              | Xóa Vai Trò

  //- Delete Confirmation Modal
  .modal.fade(id="deleteModal" tabindex="-1")
    .modal-dialog.modal-dialog-centered
      .modal-content
        .modal-header.border-0
          h5.modal-title
            i.bi.bi-exclamation-triangle.text-danger.me-2
            | Xác Nhận Xóa
          button.btn-close(type="button" data-bs-dismiss="modal")
        .modal-body
          p.mb-0 Bạn có chắc chắn muốn xóa vai trò 
            strong #{role.title}
            | ? Hành động này không thể hoàn tác.
        .modal-footer.border-0
          button.btn.btn-secondary(type="button" data-bs-dismiss="modal") Hủy
          a.btn.btn-danger(href=`${prefixAdmin}/roles/delete/${role.id}`)
            i.bi.bi-trash.me-2
            | Xóa